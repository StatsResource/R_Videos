---
title: "Statistics with R"
subtitle: "Introduction to R for Actuarial Students"
output:
  xaringan::moon_reader:
    css: xaringan-themer.css
    lib_dir: libs
    nature:
      highlightStyle: github
      countIncrementalSlides: false
---


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(magrittr)
library(knitr)
library(dplyr)
library(janitor)


```

```{r xaringan-themer, include=FALSE, warning=FALSE}
library(xaringanthemer)
style_mono_accent_inverse(
  #base_color = "#3C989E")(
  base_color = "#1c5253",
  header_font_google = google_font("Josefin Sans"),
  text_font_google   = google_font("Montserrat", "300", "300i"),
  code_font_google   = google_font("Fira Mono")
)
```


```{css, echo=FALSE}
pre {
  background: #ADD8E6;
  max-width: 100%;
  overflow-x: scroll;
}
```

* Introduction to R for Actuarial Students

* CS1B Curriculum

* Introduction to R programming
* Fundamentals of Statistical Analysis

* Question 1
---
## Q. 3

Consider a portfolio of fire insurance policies. The data for 192 policies that have claimed at least once is given in the file **Firepolicies.csv**. This file contains data on four variables:

  * **Occupancy**: The claim has arisen in five different Occupancies:
      * **TM** – for Textile Mills
      * **DW** – for Dwellings
      * **TG** – for Transporters’ Godowns
      * **CS** – for Cold Storage Premises
      * **HG** – for Hazardous Goods Storage
  * **Location**: It relates to the loss state:
      * **M** – for Maharashtra
      * **G** – for Gujarat
      * **T** – for Telangana
      * **K** – for Karnataka
      * **A** – for Andhra Pradesh
  * **Claim.size**: Refers to the amount of the claim in INR lakhs.
  * **Claimed**: An indicator variable that captures whether there was a claim in the past one year:
      * **0** – refers to NO claim in the past one year
      * **1** – refers to ONE claim in the past one year

-----

### (i)

View the data **Firepolicies.csv** for 192 entries using the `read.csv` function. The columns `Claim.Size` and `Claimed` have a numeric data type, while the other columns, `Location` and `Occupancy`, have a character data type. (1)

### (ii)

Using the **Firepolicies.csv**, calculate the proportion of:
a) Policyholders with no claims in the past one year from the state of Maharashtra. (3)
b) Policyholders with no claims in the past one year from the state of Gujarat. (1)

### (iii)

Test the hypothesis that the proportion of policyholders with no claims in the past one year is equal in both states (Maharashtra and Gujarat) at a 5% level of significance. You should state the null and alternate hypotheses, report the p-value of the test, and arrive at a clear conclusion. (5)

### (iv)

Test the hypothesis that there is no significant difference in the average claim size for Textile Mills and Transporters’ Godowns at a 5% level of significance. You should state the null and alternate hypotheses, report the p-value of the test, and arrive at a clear conclusion. Assume that population variances are equal. (6)

### (v)

The number of policies with at least one claim ($X$) for the fire insurance portfolio is modeled as a random variable with a **Binomial distribution**, $X \\sim \\text{Binomial}(n, p)$.

An Actuary wishes to fit different **Generalized Linear Models (GLMs)** to the data, assuming that the number of policies with one submitted claim has a Binomial distribution and the link function of the GLM is the logit function.
a) Fit a GLM to the data such that $p$ depends on the **Location** and **Claim.Size**, and report the summary. (4)
b) Fit a GLM to the data such that $p$ depends on the **Occupancy** and **Claim.Size**, and report the summary. (2)

### (vi)

Compare the fit of the models in parts (v)(a) and (v)(b) using **Akaike’s Information Criterion (AIC)** and comment on which model is preferable. (3)

### (vii)

Among the four variables in the **Firepolicies.csv** data, which are numerical and which are factor variables? What is the difference between the two in the context of generalized linear models? (5)

[Total 30]

-----

## **Solution to Q. 3**

### (i)

```r
> Firepolicies <- read.csv("Firepolicies.csv")
```

### (ii)

a) The proportion of policyholders with no claims from Maharashtra is 0.7346939.

```r
> Maha <- Firepolicies[Firepolicies$Location=="M",]
> Maha_0_Claims <- Maha[Maha$Claimed == 0,]
> ProporMaha_0_Claims <- nrow(Maha_0_Claims)/nrow(Maha)
> ProporMaha_0_Claims
[1] 0.7346939
```

b) The proportion of policyholders with no claims from Gujarat is 0.5909091.

```r
> Gujarat <- Firepolicies[Firepolicies$Location=="G",]
> Gujarat_0_Claims <- Gujarat[Gujarat$Claimed == 0,]
> ProporGuj_0_claims <- nrow(Gujarat_0_Claims)/nrow(Gujarat)
> ProporGuj_0_claims
[1] 0.5909091
```

### (iii)

**Null Hypothesis ($H\_0$)**: The proportion of no claims in Maharashtra is equal to the proportion of no claims in Gujarat.
**Alternative Hypothesis ($H\_1$)**: The proportion of no claims in Maharashtra is not equal to the proportion of no claims in Gujarat.

```r
> prop.test(c(nrow(Maha_0_Claims), nrow(Gujarat_0_Claims)), c(nrow(Maha), nrow(Gujarat)), correct = FALSE)
```

**R Output**:

```
2-sample test for equality of proportions without continuity correction
data: c(nrow(Maha_0_Claims), nrow(Gujarat_0_Claims)) out of c(nrow(Maha), nrow(Gujarat))
X-squared = 2.1568, df = 1, p-value = 0.1419
alternative hypothesis: two.sided
95 percent confidence interval:
 -0.04696637 0.33453595
sample estimates:
   prop 1    prop 2 
0.7346939 0.5909091
```

The p-value is 0.1419. Since the p-value (0.1419) is greater than the significance level (0.05), we have insufficient evidence to reject the null hypothesis. We conclude that there is no significant difference between the proportions of no claims in the past year for Maharashtra and Gujarat.

### (iv)

**Null Hypothesis ($H\_0$)**: The population mean of Textile Mills claims is equal to the population mean of Transporters' Godowns claims.
**Alternative Hypothesis ($H\_1$)**: The population mean of Textile Mills claims is not equal to the population mean of Transporters' Godowns claims.

```r
> Textile <- Firepolicies[Firepolicies$Occupancy=="TM",]
> Transporter <- Firepolicies[Firepolicies$Occupancy=="TG",]
> t.test(Textile$Claim.Size, Transporter$Claim.Size, var.equal = TRUE)
```

**R Output**:

```
Two Sample t-test
data: Textile$Claim.Size and Transporter$Claim.Size
t = 7.877, df = 103, p-value = 3.586e-12
alternative hypothesis: true difference in means is not equal to 0
95 percent confidence interval:
 24.27889 40.61871
sample estimates:
 mean of x  mean of y 
  98.07843   65.62963
```

The p-value is 3.586e-12. Since the p-value is much smaller than the significance level (0.05), we have sufficient evidence to reject the null hypothesis. We conclude that there is a significant difference between the average claim sizes of Textile Mills and Transporters' Godowns.

### (v)

a) The summary of the GLM model with **Location** and **Claim.Size** as predictors:

```r
> model1 <- glm(Firepolicies$Claimed ~ Firepolicies$Claim.Size + Firepolicies$Location, family = binomial())
> summary(model1)
```

**R Output**:

```
Call:
glm(formula = Firepolicies$Claimed ~ Firepolicies$Claim.Size +
 Firepolicies$Location, family = binomial())

Coefficients:
                         Estimate Std. Error z value Pr(>|z|)    
(Intercept)            -0.840330   0.453954  -1.851 0.0642 .  
Firepolicies$Claim.Size  0.003711   0.004935   0.752 0.4521    
Firepolicies$LocationG   0.198437   0.494674   0.401 0.6883    
Firepolicies$LocationK   0.205169   0.506205   0.405 0.6853    
Firepolicies$LocationM  -0.418141   0.498094  -0.839 0.4012    
Firepolicies$LocationT   0.448865   0.519037   0.865 0.3871    
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1
(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 251.91  on 191  degrees of freedom
Residual deviance: 247.65  on 186  degrees of freedom
AIC: 259.65

Number of Fisher Scoring iterations: 4
```

b) The summary of the GLM model with **Occupancy** and **Claim.Size** as predictors:

```r
> model2 <- glm(Firepolicies$Claimed ~ Firepolicies$Claim.Size + Firepolicies$Occupancy, family = binomial())
> summary(model2)
```

**R Output**:

```
Call:
glm(formula = Firepolicies$Claimed ~ Firepolicies$Claim.Size +
    Firepolicies$Occupancy, family = binomial())

Coefficients:
                             Estimate Std. Error z value Pr(>|z|)  
(Intercept)                 -0.492623   0.283188  -1.740   0.0818 .
Firepolicies$Claim.Size     -0.009519   0.004902  -1.942   0.0521 .
Firepolicies$OccupancyDW    -0.266777   0.417066  -0.640   0.5222  
Firepolicies$OccupancyHG     0.100853   0.422899   0.238   0.8115  
Firepolicies$OccupancyTG     0.817776   0.403565   2.027   0.0427 *
Firepolicies$OccupancyTM     1.063207   0.395123   2.691   0.0071 **
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 251.91  on 191  degrees of freedom
Residual deviance: 247.30  on 186  degrees of freedom
AIC: 259.3

Number of Fisher Scoring iterations: 4
```

### (vi)

The AIC for **Model 1** (Location + Claim.Size) is **259.65**, and the AIC for **Model 2** (Occupancy + Claim.Size) is **259.3**.
Since a smaller AIC value indicates a better-fitting model, **Model 2** is preferable. The model with Occupancy as a predictor provides a slightly better fit to the data.

### (vii)

  * **Numerical Variables**: `Claim.Size`, `Claimed`
  * **Factor Variables**: `Location`, `Occupancy`

In the context of GLMs, **numerical variables** are quantitative and represent a continuous range of values (e.g., Claim.Size). **Factor variables**, on the other hand, represent categories or groups (e.g., Location, Occupancy). GLMs handle factor variables by creating dummy variables for each category, which allows the model to estimate the effect of each specific category on the response variable relative to a baseline category.